#!/bin/bash
columnName=$1
input=$2
output=$3

# the file that contains the public DNS addresses of the linux boxes that we just started
FILE=publicDnsFile.txt

# This loop will ssh into the machines represented by each line generated by the starter script
# The ssh command uses stdin, and hence it directly exits the loop
# to avoid that, we attach the output to nothing, so that it can continue the loop for as long as there are
# lines in the file that we are reading from
# IMPORTANT: We will be runnning the java program on each instance, so we dont wait for one program to
# complete and exit
comds="cd ~/test/; javac Hello.java; time java Hello"
i=0
server="not decided"
while read line;do
        echo "$line"
        echo $i
        if [ $i -eq 0 ]; then
        	server=$line
        	echo $line" is the server instance"
        else
        	echo "client instance"
        fi
        ssh -i MyKeyPair.pem ubuntu@$line -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no "${comds}" < /dev/null &
        i=$((i+1))
done < $FILE

# since we started the programs simultaneously, we will wait for the two of them to complete after this step
wait
echo "server instance was "$server
echo "reached the end of sort script"
echo "exiting sort script"
exit